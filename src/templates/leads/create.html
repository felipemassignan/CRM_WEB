{% extends 'base.html' %}

{% block title %}Novo Lead - CRM Prospecção Industrial{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1><i class="bi bi-person-plus"></i> Novo Lead</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('leads.index') }}">Leads</a></li>
                <li class="breadcrumb-item active">Novo Lead</li>
            </ol>
        </nav>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="post">
            <div class="row mb-3">
                <div class="col-md-12">
                    <h5 class="card-title">Informações Básicas</h5>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nome <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="position" class="form-label">Cargo</label>
                        <select class="form-select" id="position" name="position">
                            <option value="">Selecione...</option>
                            {% for position in position_choices %}
                            <option value="{{ position }}">{{ position }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="company" class="form-label">Empresa</label>
                        <input type="text" class="form-control" id="company" name="company">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="industry" class="form-label">Setor</label>
                        <select class="form-select" id="industry" name="industry">
                            <option value="">Selecione...</option>
                            {% for industry in industry_choices %}
                            <option value="{{ industry }}">{{ industry }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12">
                    <h5 class="card-title">Contato</h5>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="phone" class="form-label">Telefone</label>
                        <input type="text" class="form-control" id="phone" name="phone">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="linkedin_url" class="form-label">URL do LinkedIn</label>
                        <input type="url" class="form-control" id="linkedin_url" name="linkedin_url">
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12">
                    <h5 class="card-title">Localização</h5>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="region" class="form-label">Região</label>
                        <select class="form-select" id="region" name="region">
                            <option value="">Selecione...</option>
                            {% for region in region_choices %}
                            <option value="{{ region }}">{{ region }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="state" class="form-label">Estado</label>
                        <input type="text" class="form-control" id="state" name="state">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="city" class="form-label">Cidade</label>
                        <input type="text" class="form-control" id="city" name="city">
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12">
                    <h5 class="card-title">Classificação</h5>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        <select class="form-select" id="status" name="status">
                            {% for status in status_choices %}
                            <option value="{{ status }}">{{ status }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="priority" class="form-label">Prioridade</label>
                        <select class="form-select" id="priority" name="priority">
                            {% for priority in priority_choices %}
                            <option value="{{ priority }}">{{ priority }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="source" class="form-label">Origem</label>
                        <select class="form-select" id="source" name="source">
                            {% for source in source_choices %}
                            <option value="{{ source }}">{{ source }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12">
                    <h5 class="card-title">Informações Adicionais</h5>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="company_size" class="form-label">Tamanho da Empresa</label>
                        <select class="form-select" id="company_size" name="company_size">
                            <option value="">Selecione...</option>
                            <option value="1-10">1-10 funcionários</option>
                            <option value="11-50">11-50 funcionários</option>
                            <option value="51-200">51-200 funcionários</option>
                            <option value="201-500">201-500 funcionários</option>
                            <option value="501-1000">501-1000 funcionários</option>
                            <option value="1001+">1001+ funcionários</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="annual_revenue" class="form-label">Faturamento Anual</label>
                        <select class="form-select" id="annual_revenue" name="annual_revenue">
                            <option value="">Selecione...</option>
                            <option value="Até R$ 1 milhão">Até R$ 1 milhão</option>
                            <option value="R$ 1-10 milhões">R$ 1-10 milhões</option>
                            <option value="R$ 10-50 milhões">R$ 10-50 milhões</option>
                            <option value="R$ 50-100 milhões">R$ 50-100 milhões</option>
                            <option value="R$ 100-500 milhões">R$ 100-500 milhões</option>
                            <option value="Acima de R$ 500 milhões">Acima de R$ 500 milhões</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="technologies_used" class="form-label">Tecnologias Utilizadas</label>
                        <input type="text" class="form-control" id="technologies_used" name="technologies_used" 
                               placeholder="Ex: Visão Computacional, Automação, Robótica...">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="pain_points" class="form-label">Pontos de Dor</label>
                        <textarea class="form-control" id="pain_points" name="pain_points" rows="3"
                                  placeholder="Descreva os principais desafios ou problemas que o lead enfrenta..."></textarea>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="notes" class="form-label">Observações</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <a href="{{ url_for('leads.index') }}" class="btn btn-outline-secondary me-2">Cancelar</a>
                <button type="submit" class="btn btn-primary">Criar Lead</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Máscara para telefone
    document.getElementById('phone').addEventListener('input', function (e) {
        let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
        e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
    });

    // Validação do formulário
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!document.getElementById('name').value.trim()) {
            e.preventDefault();
            alert('Por favor, preencha o nome do lead.');
            document.getElementById('name').focus();
        }
    });
</script>
{% endblock %}